/**
 * Simple 5x7 pixel font text renderer
 * Supports numbers and common characters
 */

/**
 * Draw text on the buffer using pixel font
 * @param view - The pixel buffer (Uint32Array)
 * @param width - Buffer width in pixels
 * @param text - Text to draw
 * @param x - X position
 * @param y - Y position
 * @param color - Text color (default: white)
 */
export function drawText(
    view: Uint32Array,
    width: number,
    text: string,
    x: number,
    y: number,
    color: number = 0xFFFFFFFF
) {
    for (let i = 0; i < text.length; i++) {
        const char = text[i];
        const pattern = getCharPattern(char);

        for (let row = 0; row < 7; row++) {
            for (let col = 0; col < 5; col++) {
                if (pattern[row] & (1 << (4 - col))) {
                    const px = x + i * 6 + col;
                    const py = y + row;
                    if (px >= 0 && px < width && py >= 0 && py < view.length / width) {
                        view[py * width + px] = color;
                    }
                }
            }
        }
    }
}

/**
 * Draw centered text on the buffer
 * @param view - The pixel buffer (Uint32Array)
 * @param width - Buffer width in pixels
 * @param height - Buffer height in pixels
 * @param text - Text to draw
 * @param y - Y position
 * @param color - Text color (default: white)
 */
export function drawCenteredText(
    view: Uint32Array,
    width: number,
    height: number,
    text: string,
    y: number,
    color: number = 0xFFFFFFFF
) {
    const x = Math.floor((width - text.length * 6) / 2);
    drawText(view, width, text, x, y, color);
}

/**
 * Draw large scaled text on the buffer
 * @param view - The pixel buffer (Uint32Array)
 * @param width - Buffer width in pixels
 * @param height - Buffer height in pixels
 * @param text - Text to draw
 * @param x - X position
 * @param y - Y position
 * @param scale - Scaling factor (default: 5)
 * @param color - Text color (default: white)
 */
export function drawLargeText(
    view: Uint32Array,
    width: number,
    height: number,
    text: string,
    x: number,
    y: number,
    scale: number = 5,
    color: number = 0xFFFFFFFF
) {
    const charWidth = 6 * scale;

    for (let i = 0; i < text.length; i++) {
        const char = text[i];
        const pattern = getCharPattern(char);
        const charX = x + i * charWidth;

        for (let row = 0; row < 7; row++) {
            for (let col = 0; col < 5; col++) {
                if (pattern[row] & (1 << (4 - col))) {
                    // Draw scaled block
                    for (let dy = 0; dy < scale; dy++) {
                        for (let dx = 0; dx < scale; dx++) {
                            const px = charX + col * scale + dx;
                            const py = y + row * scale + dy;

                            if (px >= 0 && px < width && py >= 0 && py < height) {
                                view[py * width + px] = color;
                            }
                        }
                    }
                }
            }
        }
    }
}

const CHAR_PATTERN: Record<string, number[]> = {
    // Numbers
    '0': [0x0E, 0x11, 0x11, 0x11, 0x11, 0x11, 0x0E],
    '1': [0x04, 0x0C, 0x04, 0x04, 0x04, 0x04, 0x0E],
    '2': [0x0E, 0x11, 0x01, 0x0E, 0x10, 0x10, 0x1F],
    '3': [0x0E, 0x11, 0x01, 0x0E, 0x01, 0x11, 0x0E],
    '4': [0x11, 0x11, 0x11, 0x1F, 0x01, 0x01, 0x01],
    '5': [0x1F, 0x10, 0x1E, 0x01, 0x01, 0x11, 0x0E],
    '6': [0x0E, 0x10, 0x10, 0x1E, 0x11, 0x11, 0x0E],
    '7': [0x1F, 0x01, 0x02, 0x04, 0x08, 0x08, 0x08],
    '8': [0x0E, 0x11, 0x11, 0x0E, 0x11, 0x11, 0x0E],
    '9': [0x0E, 0x11, 0x11, 0x0F, 0x01, 0x01, 0x0E],

    // Uppercase letters
    'A': [0x0E, 0x11, 0x11, 0x1F, 0x11, 0x11, 0x11],
    'B': [0x1E, 0x11, 0x11, 0x1E, 0x11, 0x11, 0x1E],
    'C': [0x0E, 0x11, 0x10, 0x10, 0x10, 0x11, 0x0E],
    'D': [0x1E, 0x11, 0x11, 0x11, 0x11, 0x11, 0x1E],
    'E': [0x1F, 0x10, 0x10, 0x1E, 0x10, 0x10, 0x1F],
    'F': [0x1F, 0x10, 0x10, 0x1E, 0x10, 0x10, 0x10],
    'G': [0x0E, 0x11, 0x10, 0x17, 0x11, 0x11, 0x0F],
    'H': [0x11, 0x11, 0x11, 0x1F, 0x11, 0x11, 0x11],
    'I': [0x0E, 0x04, 0x04, 0x04, 0x04, 0x04, 0x0E],
    'J': [0x07, 0x02, 0x02, 0x02, 0x02, 0x12, 0x0C],
    'K': [0x11, 0x12, 0x14, 0x18, 0x14, 0x12, 0x11],
    'L': [0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x1F],
    'M': [0x11, 0x1B, 0x15, 0x11, 0x11, 0x11, 0x11],
    'N': [0x11, 0x11, 0x19, 0x15, 0x13, 0x11, 0x11],
    'O': [0x0E, 0x11, 0x11, 0x11, 0x11, 0x11, 0x0E],
    'P': [0x1E, 0x11, 0x11, 0x1E, 0x10, 0x10, 0x10],
    'Q': [0x0E, 0x11, 0x11, 0x11, 0x15, 0x12, 0x0D],
    'R': [0x1E, 0x11, 0x11, 0x1E, 0x14, 0x12, 0x11],
    'S': [0x0F, 0x10, 0x10, 0x0E, 0x01, 0x01, 0x1E],
    'T': [0x1F, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04],
    'U': [0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x0E],
    'V': [0x11, 0x11, 0x11, 0x11, 0x11, 0x0A, 0x04],
    'W': [0x11, 0x11, 0x11, 0x15, 0x15, 0x15, 0x0A],
    'X': [0x11, 0x11, 0x0A, 0x04, 0x0A, 0x11, 0x11],
    'Y': [0x11, 0x11, 0x11, 0x0A, 0x04, 0x04, 0x04],
    'Z': [0x1F, 0x01, 0x02, 0x04, 0x08, 0x10, 0x1F],

    // Lowercase letters
    'a': [0x00, 0x00, 0x0E, 0x01, 0x0F, 0x11, 0x0F],
    'b': [0x10, 0x10, 0x16, 0x19, 0x11, 0x11, 0x1E],
    'c': [0x00, 0x00, 0x0E, 0x10, 0x10, 0x10, 0x0E],
    'd': [0x01, 0x01, 0x0D, 0x13, 0x11, 0x11, 0x0F],
    'e': [0x00, 0x00, 0x0E, 0x11, 0x1F, 0x10, 0x0E],
    'f': [0x06, 0x09, 0x08, 0x1E, 0x08, 0x08, 0x08],
    'g': [0x00, 0x00, 0x0F, 0x11, 0x0F, 0x01, 0x0E],
    'h': [0x10, 0x10, 0x16, 0x19, 0x11, 0x11, 0x11],
    'i': [0x04, 0x00, 0x0C, 0x04, 0x04, 0x04, 0x0E],
    'j': [0x02, 0x00, 0x06, 0x02, 0x02, 0x12, 0x0C],
    'k': [0x10, 0x10, 0x12, 0x14, 0x18, 0x14, 0x12],
    'l': [0x0C, 0x04, 0x04, 0x04, 0x04, 0x04, 0x0E],
    'm': [0x00, 0x00, 0x1A, 0x15, 0x15, 0x15, 0x15],
    'n': [0x00, 0x00, 0x16, 0x19, 0x11, 0x11, 0x11],
    'o': [0x00, 0x00, 0x0E, 0x11, 0x11, 0x11, 0x0E],
    'p': [0x00, 0x00, 0x1E, 0x11, 0x1E, 0x10, 0x10],
    'q': [0x00, 0x00, 0x0D, 0x13, 0x0F, 0x01, 0x01],
    'r': [0x00, 0x00, 0x16, 0x19, 0x10, 0x10, 0x10],
    's': [0x00, 0x00, 0x0E, 0x10, 0x0E, 0x01, 0x1E],
    't': [0x04, 0x04, 0x1E, 0x04, 0x04, 0x05, 0x02],
    'u': [0x00, 0x00, 0x11, 0x11, 0x11, 0x13, 0x0D],
    'v': [0x00, 0x00, 0x11, 0x11, 0x11, 0x0A, 0x04],
    'w': [0x00, 0x00, 0x11, 0x11, 0x15, 0x15, 0x0A],
    'x': [0x00, 0x00, 0x11, 0x0A, 0x04, 0x0A, 0x11],
    'y': [0x00, 0x00, 0x11, 0x11, 0x0F, 0x01, 0x0E],
    'z': [0x00, 0x00, 0x1F, 0x02, 0x04, 0x08, 0x1F],

    // Symbols
    '!': [0x04, 0x04, 0x04, 0x04, 0x04, 0x00, 0x04],
    '?': [0x0E, 0x11, 0x02, 0x04, 0x04, 0x00, 0x04],
    '.': [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04],
    ',': [0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x08],
    ':': [0x00, 0x00, 0x04, 0x00, 0x00, 0x04, 0x00],
    ';': [0x00, 0x00, 0x04, 0x00, 0x00, 0x04, 0x08],
    '\'': [0x04, 0x04, 0x08, 0x00, 0x00, 0x00, 0x00],
    '"': [0x0A, 0x0A, 0x14, 0x00, 0x00, 0x00, 0x00],
    '-': [0x00, 0x00, 0x00, 0x1F, 0x00, 0x00, 0x00],
    '+': [0x00, 0x04, 0x04, 0x1F, 0x04, 0x04, 0x00],
    '=': [0x00, 0x00, 0x1F, 0x00, 0x1F, 0x00, 0x00],
    '*': [0x00, 0x15, 0x0E, 0x1F, 0x0E, 0x15, 0x00],
    '/': [0x01, 0x01, 0x02, 0x04, 0x08, 0x10, 0x10],
    '\\': [0x10, 0x10, 0x08, 0x04, 0x02, 0x01, 0x01],
    '(': [0x02, 0x04, 0x08, 0x08, 0x08, 0x04, 0x02],
    ')': [0x08, 0x04, 0x02, 0x02, 0x02, 0x04, 0x08],
    '[': [0x0E, 0x08, 0x08, 0x08, 0x08, 0x08, 0x0E],
    ']': [0x0E, 0x02, 0x02, 0x02, 0x02, 0x02, 0x0E],
    '{': [0x02, 0x04, 0x04, 0x08, 0x04, 0x04, 0x02],
    '}': [0x08, 0x04, 0x04, 0x02, 0x04, 0x04, 0x08],
    '<': [0x02, 0x04, 0x08, 0x10, 0x08, 0x04, 0x02],
    '>': [0x08, 0x04, 0x02, 0x01, 0x02, 0x04, 0x08],
    '_': [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F],
    '~': [0x00, 0x00, 0x08, 0x15, 0x02, 0x00, 0x00],
    '|': [0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04],
    '@': [0x0E, 0x11, 0x17, 0x15, 0x17, 0x10, 0x0E],
    '#': [0x0A, 0x0A, 0x1F, 0x0A, 0x1F, 0x0A, 0x0A],
    '$': [0x04, 0x0F, 0x14, 0x0E, 0x05, 0x1E, 0x04],
    '%': [0x18, 0x19, 0x02, 0x04, 0x08, 0x13, 0x03],
    '^': [0x04, 0x0A, 0x11, 0x00, 0x00, 0x00, 0x00],
    '&': [0x08, 0x14, 0x14, 0x08, 0x15, 0x12, 0x0D],
    ' ': [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00],
};

/**
 * Get the pixel pattern for a character
 * @param char - Character to get pattern for
 * @returns Array of 7 numbers representing the 5x7 pixel pattern
 */
export function getCharPattern(char: string): number[] {
    return CHAR_PATTERN[char] || CHAR_PATTERN[' '];
}
